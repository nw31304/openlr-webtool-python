import unittest
from shapely import wkb, LineString
from decoding_analysis_tool.main import analyze
from tomtom_sqlite import TomTomMapReaderSQLite
from decoder_configs import StrictConfig
from geotool_4326 import GeoTool_4326




class MyTestCase(unittest.TestCase):
    def test_src_is_tgt(self):
        geom1= "000000000200000028401803F141205BC04048C7FC6540CC7940180410B630A9154048C7F91E646F15401804284DFCE3154048C7F583A53B8E4018044284DFCE314048C7EEF5EC80C74018045A1CAC08314048C7E8BC169C244018047ECFE9B7BF4048C7E0DED288CE401804D2B2BFDB4D4048C7D07C84B5DD4018051EB851EB854048C7C3B4F61672401805681ECD4AA14048C7B83CF2CF964018062F5989DF114048C79ABF338716401806E6D9BE4CD74048C78088509BFA40180771C970F7BA4048C76F2A5A469D401807E7C06E19B94048C7620EE8D10F401808754F3775B84048C753F7CED9174018090D5A5B96294048C74538EF34D740180A57A786C2274048C7256FFC115E40180AB8A5CE5B424048C71BEF49CF5740180ADD590C0AD04048C717ACC4EF8940180AEFB2AAE2974048C715B573EAB340180B2E9CCB7D414048C70DD82FD75E40180B923A29C77A4048C6FF6D33094240180BE8BC169C244048C6F102363B2540180C1D29DC725C4048C6E685DB76B440180C39FFD60E954048C6DFF822BBED40180C5436B8F9B14048C6D916872B0240180C764ADFF8234048C6CF41F212D740180C8B439581064048C6C6BCE8533B40180C9AFE1DA7B14048C6BF3387160940180CAAB8A5CE5B4048C6B65A9A804940180CBA732DF5064048C6A6F3F52FC240180CBD1244A6224048C69B280F12C240180CAAB8A5CE5B4048C680F12C27A640180CAAB8A5CE5B4048C67913E8145140180CB5350092CD4048C66FE718A86D40180CFE9B7BF1E94048C64ECE9A2C6740180D10F51AC9B04048C6469D7342EE40180D4801F751054048C62E09FE868340180D57BC7F77AF4048C626809D495240180D6A161E4F764048C621EA35936040180D844D013A934048C61C044284E0"
        ls = wkb.loads(geom1, hex=True)
        assert(isinstance(ls, LineString))
        rdr = TomTomMapReaderSQLite(
            db_filename="/Users/dave/projects/python/openlr/data/lux-orbis.db",
            mod_spatialite="/opt/homebrew/anaconda3/envs/openlr/lib/mod_spatialite",
            lines_table="links",
            nodes_table="junctions",
            geo_tool=GeoTool_4326(),
            config=StrictConfig
        )
        analyze("CwRE+CM+jxNMHgOn+kYTHg==", ls, rdr, 20)


    def test_src_is_not_tgt(self):
        geom1 = "000000000200000028401803F141205BC04048C7FC6540CC7940180410B630A9154048C7F91E646F15401804284DFCE3154048C7F583A53B8E4018044284DFCE314048C7EEF5EC80C74018045A1CAC08314048C7E8BC169C244018047ECFE9B7BF4048C7E0DED288CE401804D2B2BFDB4D4048C7D07C84B5DD4018051EB851EB854048C7C3B4F61672401805681ECD4AA14048C7B83CF2CF964018062F5989DF114048C79ABF338716401806E6D9BE4CD74048C78088509BFA40180771C970F7BA4048C76F2A5A469D401807E7C06E19B94048C7620EE8D10F401808754F3775B84048C753F7CED9174018090D5A5B96294048C74538EF34D740180A57A786C2274048C7256FFC115E40180AB8A5CE5B424048C71BEF49CF5740180ADD590C0AD04048C717ACC4EF8940180AEFB2AAE2974048C715B573EAB340180B2E9CCB7D414048C70DD82FD75E40180B923A29C77A4048C6FF6D33094240180BE8BC169C244048C6F102363B2540180C1D29DC725C4048C6E685DB76B440180C39FFD60E954048C6DFF822BBED40180C5436B8F9B14048C6D916872B0240180C764ADFF8234048C6CF41F212D740180C8B439581064048C6C6BCE8533B40180C9AFE1DA7B14048C6BF3387160940180CAAB8A5CE5B4048C6B65A9A804940180CBA732DF5064048C6A6F3F52FC240180CBD1244A6224048C69B280F12C240180CAAB8A5CE5B4048C680F12C27A640180CAAB8A5CE5B4048C67913E8145140180CB5350092CD4048C66FE718A86D40180CFE9B7BF1E94048C64ECE9A2C6740180D10F51AC9B04048C6469D7342EE40180D4801F751054048C62E09FE868340180D57BC7F77AF4048C626809D495240180D6A161E4F764048C621EA35936040180D844D013A934048C61C044284E0"
        ls = wkb.loads(geom1, hex=True)
        assert (isinstance(ls, LineString))
        rdr = TomTomMapReaderSQLite(
            db_filename="/Users/dave/projects/python/openlr/data/lux-osm.db",
            mod_spatialite="/opt/homebrew/anaconda3/envs/openlr/lib/mod_spatialite",
            lines_table="links",
            nodes_table="junctions",
            geo_tool=GeoTool_4326(),
            config=StrictConfig
        )
        analyze("CwRE+CM+jxNMHgOn+kYTHg==", ls, rdr, 20)


if __name__ == '__main__':
    unittest.main()
